<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title></title>
    <link rel="stylesheet" type="text/css" href="../layui/css/layui.css"/>
    <script src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
</head>
<body style="padding: 10px;">

<div class="layui-row layui-col-space15">

    <div class="layui-col-lg6" id="formDiv"  style="border: 1px  solid #F2F2F2;margin-top: 20px;" >
        <div style="margin-top: 11px"></div>
        <form class="layui-form" lay-filter='formDetaileCustomerPlan' action="">
            <input type="hidden" name="cusNo"  />

            <div class="layui-form-item" style="margin-left: -20px">
                <div class="layui-inline">
                    <label class="layui-form-label" style="margin-left: -10px">机会编号</label>
                    <div class="layui-input-inline" style="width: 200px;margin-left: -4px">
                        <input type="text" readonly="readonly" name="saleChanceId" lay-verify="required" autocomplete="off" placeholder="请输入标题" class="layui-input">
                    </div>
                </div>

                <div class="layui-inline">
                    <label class="layui-form-label" style="margin-left: -20px">客户名称</label>
                    <div class="layui-input-inline" style="width: 210px;margin-left: -4px">
                        <input type="text" readonly="readonly" name="cusName" lay-verify="required" autocomplete="off" placeholder="请输入标题" class="layui-input">
                    </div>
                </div>
            </div>



            <div class="layui-form-item" style="margin-left: -20px">
                <div class="layui-inline">
                    <label class="layui-form-label" style="margin-left: -10px">机会来源</label>
                    <div class="layui-input-inline" style="width: 200px;margin-left: -4px">
                        <input type="text"  readonly="readonly" name="saleSource" lay-verify="required" autocomplete="off" placeholder="请输入标题" class="layui-input">
                    </div>
                </div>

                <div class="layui-inline">
                    <label class="layui-form-label" style="margin-left: -20px">状态为</label>
                    <div class="layui-input-inline" style="width: 210px;margin-left: -4px">
                        <input type="text" readonly="readonly"  name="saleChanceState" lay-verify="required" autocomplete="off" placeholder="请输入标题" class="layui-input">
                    </div>
                </div>
            </div>

            <div class="layui-form-item" style="margin-left: -20px">
                <div class="layui-inline">
                    <label class="layui-form-label" style="margin-left: -10px">联系人</label>
                    <div class="layui-input-inline" style="width: 200px;margin-left: -4px">
                        <input type="text" readonly="readonly" name="ctName" lay-verify="required" autocomplete="off" placeholder="请输入标题" class="layui-input">
                    </div>
                </div>

                <div class="layui-inline">
                    <label class="layui-form-label" style="margin-left: -20px">联系电话</label>
                    <div class="layui-input-inline" style="width: 210px;margin-left: -4px">
                        <input type="text" readonly="readonly" name="ctPhone" lay-verify="required" autocomplete="off" placeholder="请输入标题" class="layui-input">
                    </div>
                </div>
            </div>

            <div class="layui-form-item" style="margin-left: -20px">
                <div class="layui-inline">
                    <label class="layui-form-label" style="margin-left: -10px">成功几率</label>
                    <div class="layui-input-inline" style="width: 200px;margin-left: -4px">
                        <input type="text" readonly="readonly" name="success" lay-verify="required" autocomplete="off" placeholder="请输入标题" class="layui-input">
                    </div>
                </div>

                <div class="layui-inline">
                    <label class="layui-form-label" style="margin-left: -20px">指派时间</label>
                    <div class="layui-input-inline" style="width: 210px;margin-left: -4px">
                        <input type="text" readonly="readonly" name="assignTime" lay-verify="required" autocomplete="off" placeholder="请输入标题" class="layui-input">
                    </div>
                </div>
            </div>

            <div class="layui-form-item" style="margin-left: -20px">
                <div class="layui-inline">
                    <label class="layui-form-label"style="margin-left: -10px">概要</label>
                    <div class="layui-input-inline" style="margin-left: -4px;width: 520px">
                        <input type="text" readonly="readonly" name="profile" lay-verify="required" autocomplete="off" placeholder="请输入标题" class="layui-input">
                    </div>
                </div>
            </div>

            <div class="layui-form-item" style="margin-left: -20px">
                <div class="layui-inline">
                    <label class="layui-form-label" style="margin-left: -10px">机会描述</label>
                    <div class="layui-input-inline" style="margin-left: -4px;width: 520px">
                        <textarea type="text"  readonly="readonly" name="descript" lay-verify="required" autocomplete="off" placeholder="请输入标题" class="layui-textarea"></textarea>
                    </div>
                </div>
            </div>

            <div class="layui-form-item" style="margin-left: -20px">
                <div class="layui-inline">
                    <label class="layui-form-label" style="margin-left: -10px">创建人</label>
                    <div class="layui-input-inline" style="width: 200px;margin-left: -4px">
                        <input type="text" readonly="readonly" name="createPerson" lay-verify="required" autocomplete="off" placeholder="请输入标题" class="layui-input">
                    </div>
                </div>

                <div class="layui-inline">
                    <label class="layui-form-label" style="margin-left: -20px">创建时间</label>
                    <div class="layui-input-inline" style="width: 210px;margin-left: -4px">
                        <input type="text" readonly="readonly" name="createTime" lay-verify="required" autocomplete="off" placeholder="请输入标题" class="layui-input">
                    </div>
                </div>
            </div>


        </form>

    </div>

    <div class="layui-col-lg6"  style="height: 600px">
        <table id="tabCustomerPlan" lay-filter="tabCustomerPlan">
        </table>
    </div>


</div>


<script src="../layui/layui.js" type="text/javascript" charset="utf-8"></script>


<script type="text/html" id="barCustomerPlan">
    <a class="layui-btn layui-btn-xs" lay-event="create">新增</a>
    <a class="layui-btn layui-btn-xs" lay-event="edit">修改</a>
    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
</script>

<script>
    var row = null
    var table = null
           layui.use(['form','jquery','layer'],function(){
            var form = layui.form
            var $ = layui.jquery
            var layer=layui.layer
            form.render()
            form.val('formDetaileCustomerPlan',{
                "saleChanceId":parent.row.saleChanceId,
                "cusName":parent.row.cusName,
                "saleSource":parent.row.saleSource,
                "saleChanceState":parent.row.saleChanceState,
                "ctName":parent.row.ctPhone,
                "ctPhone":parent.row.ctPhone,
                "success":parent.row.success,
                "assignTime":parent.row.assignTime,
                "profile":parent.row.profile,
                "descript":parent.row.descript,
                "createPerson":parent.row.createPerson,
                "createTime":parent.row.createTime,

            })
    });
</script>

<script>
    var row = null
    var table = null
    var data =null
    var layer = null
    layui.use(['table','jquery'], function(){
        table = layui.table;
        var $ = layui.jquery;
        layer = layui.layer

        //第一个实例
        table.render({
            elem: '#tabCustomerPlan'
            ,height: 'full-80'
            ,url: 'http://localhost:8080/customerPlan/customerPlans' //数据接口
            ,page: true //开启分页
            ,method: "POST"
            ,where:{
                saleChanceId: parent.row.saleChanceId
            }
            ,toolbar:'#barCustomerPlan'  //添加编辑工具栏按钮
            ,defaultToolbar:[] //去掉默认的工具栏按钮
            ,limits:[5,10,15,20]
            ,limit:10
            ,cols: [[ //表头
                {checkbox:true}
                ,{field: 'cusPlanId', title: '开发计划编号',align:'center',width: 120}
                ,{field: 'context', title: '计划内容',align:'center'}
                ,{field: 'time', title: '执行时间',align:'center',width: 120}

                /*,templet:function(item){
           if(item.cusCredit=='一级'){
               return '一等'
           }else{
               return item.cusCredit
           }
       }*/
            ]]
        });

        //监听事件
        table.on('toolbar(tabCustomerPlan)', function(obj){
            var checkStatus = table.checkStatus(obj.config.id);
            data = checkStatus.data[0]
            switch(obj.event){
                case 'create':
                    layer.open({
                        type: 2 //此处以iframe举例
                        ,title: '新增计划信息'
                        ,area: ['600px', '500px']
                        ,shade: 0.5//阴影（0-1之间的数）
                        ,maxmin: true//最大、最小化按钮
                        ,offset: [ //为了演示，随机坐标
                            ($(window).height()-520)/2
                            ,($(window).width()-600)/2
                        ]
                        ,content: 'addcustomerplan.html'
                    });
                    break;

                case 'del':
                    if(checkStatus.data.length<=0){
                        layer.alert("请选择要删除的行");
                        return;
                    }
                    layer.confirm('确认要删除选中的这行吗？', function(index){
                        var ids = []
                        for(var i=0; i<checkStatus.data.length; i++){
                            ids.push(checkStatus.data[i].cusPlanId)
                        }

                        $.ajax({
                            url:'http://localhost:8080/customerPlan/delCustomerPlan',
                            type:'POST',
                            dataType:'JSON',
                            data:{
                                ids:ids.join(",")
                            },
                            success:function(obj){
                                layer.msg(obj.msg);
                                table.reload('tabCustomerPlan')
                            }
                        })

                        layer.close(index);
                    });

                    break;
                case 'edit':
                    if(checkStatus.data.length<=0){
                        layer.alert("请选择要修改的行");
                        return;
                    }
                    row = checkStatus.data[0]
                    layer.open({
                        type: 2 //此处以iframe举例
                        ,title: '修改计划信息'
                        ,area: ['600px', '500px']
                        ,shade: 0.5 //背景阴影0~1
                        ,maxmin: true  //最大，最小化按钮
                        ,offset: [ //为了演示，随机坐标
                            ($(window).height()-520)/2
                            ,($(window).width()-600)/2
                        ]
                        ,content: 'updatecustomerplan.html'
                        // ,zIndex: layer.zIndex //重点1
                        // ,success: function(layero){
                        //   layer.setTop(layero); //重点2
                        // }

                    });
                    break;

            };
        });

        table.on('rowDouble(tabCustomerPlan)', function(obj){
            data = obj.data;
            //标注选中样式
            layer.open({
                type: 2 //此处以iframe举例
                ,title: '开发计划的详细信息'
                ,area: ['500px', '400px']
                ,shade: 0.5//阴影（0-1之间的数）
                ,maxmin: true//最大、最小化按钮
                ,offset: [ //为了演示，随机坐标
                    ($(window).height()-520)/2
                    ,($(window).width()-600)/2
                ]
                ,content: 'cusplandetaile.html'
                // ,yes:function () {
                //     layer.closeAll();
                // }
            });
        });


    });
    function myalert(msg){
        layer.msg(msg, {icon:6})
    }
</script>



</body>
</html>



